<!DOCTYPE html>
<html lang="en" class="h-full overflow-y-auto snap-y snap-mandatory">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Snap Scroll Tailwind Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            height: 100%;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }
        body {
            min-height: 100%;
            margin: 0;
        }
        section {
            height: 100svh;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @supports (height: 100dvh) {
            section {
                height: 100dvh;
            }
        }
    </style>
</head>
<body class="bg-black">

    <script>
        (function () {
          // Safari 15+ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Navigation Timing L2
          const nav = performance.getEntriesByType('navigation')[0];
          if (!nav) return;                         // ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ‹: Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÐ¼
        
          const isReload = nav.type === 'reload';   // Ð¶ÐµÑÑ‚ PTR Ð¸Ð»Ð¸ ÐºÐ»Ð¸Ðº Ð¿Ð¾ ðŸ”„
          const alreadyFixed = sessionStorage.getItem('ptrFixed');
        
          if (isReload && !alreadyFixed) {
            // 1-Ð¹ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ Ð¿Ð¾ÑÐ»Ðµ pull-to-refresh â†’ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Â«Ð¿Ð¾-Ñ‡Ð¸ÑÑ‚Ð¾Ð¼ÑƒÂ»
            sessionStorage.setItem('ptrFixed', '1');
            location.replace(window.location.href); // Ð±ÐµÐ· Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
          } else {
            // Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð»Ð¸ 2-Ð¹ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ â†’ ÑÐ½Ð¸Ð¼Ð°ÐµÐ¼ Ñ„Ð»Ð°Ð³ Ð¸ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾ Ð½Ð°Ð²ÐµÑ€Ñ…
            sessionStorage.removeItem('ptrFixed');
            requestAnimationFrame(() => scrollTo(0, 0));
          }
        })();
        </script>

    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">FIX 2</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 2</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 3</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 4</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 5</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 6</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 7</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 8</div>
    </section>
    <div style="height:1px"></div>

    <script>
        const root = document.documentElement;
        
        // Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Â«Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð½Ð° 0 Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ snapÂ»
        const goTop = () => {
          root.style.scrollSnapType = 'none';
          scrollTo(0, 0);
          requestAnimationFrame(()=>{
            scrollTo(0, 0);
            root.style.scrollSnapType = 'y mandatory';
          });
        };
        
        // 1) Ð¿ÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°
        addEventListener('DOMContentLoaded', () => requestAnimationFrame(goTop));
        
        // 2) Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¸Ð· bfcache
        addEventListener('pageshow', e => e.persisted && goTop());
        
        // 3) pull-to-refresh: Ð¶Ð´Ñ‘Ð¼, Ð¿Ð¾ÐºÐ° Ð¿Ð°Ð»ÐµÑ† Ð¾Ñ‚Ð¿ÑƒÑÑ‚ÑÑ‚ Ð¸ Ð¸Ð½ÐµÑ€Ñ†Ð¸Ñ ÑÑ‚Ð¸Ñ…Ð½ÐµÑ‚
        let lock = false, idle;
        addEventListener('scroll', () => {
          clearTimeout(idle);
          idle = setTimeout(()=>{
            // ÐµÑÐ»Ð¸ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ÑÑ Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… 0 Â± 80 px â†’ Ð²Ñ‹Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼
            if (scrollY > -20 && scrollY < 80 && !lock) {
              lock = true;          // Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½ÑƒÑŽ Ð°ÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸ÑŽ
              goTop();
              setTimeout(()=>lock = false, 300);  // Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ°
            }
          }, 120);                  // Ð´Ð¾Ð»ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ñ€Ñ‹Ð²Ð¾Ðº Safari
        }, { passive:true });
        
        // 4) Ð¿ÐµÑ€ÐµÐ´ ÑƒÑ…Ð¾Ð´Ð¾Ð¼ ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑŽ
        addEventListener('beforeunload', ()=>scrollTo(0,0));
        </script>

</body>
</html> 