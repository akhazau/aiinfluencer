<!DOCTYPE html>
<html lang="en" class="h-full overflow-y-auto snap-y snap-mandatory">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Snap Scroll Tailwind Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            height: 100%;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }
        body {
            min-height: 100%;
            margin: 0;
        }
        section {
            height: 100svh;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @supports (height: 100dvh) {
            section {
                height: 100dvh;
            }
        }
    </style>
</head>
<body class="bg-black">

    <script>
        (function () {
          // Safari 15+ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Navigation Timing L2
          const nav = performance.getEntriesByType('navigation')[0];
          if (!nav) return;                         // —Å—Ç–∞—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã: –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        
          const isReload = nav.type === 'reload';   // –∂–µ—Å—Ç PTR –∏–ª–∏ –∫–ª–∏–∫ –ø–æ üîÑ
          const alreadyFixed = sessionStorage.getItem('ptrFixed');
        
          if (isReload && !alreadyFixed) {
            // 1-–π –ø—Ä–æ—Ö–æ–¥ –ø–æ—Å–ª–µ pull-to-refresh ‚Üí –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º ¬´–ø–æ-—á–∏—Å—Ç–æ–º—É¬ª
            sessionStorage.setItem('ptrFixed', '1');
            location.replace(window.location.href); // –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
          } else {
            // –æ–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ 2-–π –ø—Ä–æ—Ö–æ–¥ ‚Üí —Å–Ω–∏–º–∞–µ–º —Ñ–ª–∞–≥ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞–≤–µ—Ä—Ö
            sessionStorage.removeItem('ptrFixed');
            requestAnimationFrame(() => scrollTo(0, 0));
          }
        })();
        </script>

    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">FIX 1</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 2</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 3</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 4</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 5</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 6</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-900">
        <div class="text-3xl font-bold text-white">Section 7</div>
    </section>
    <section class="snap-start flex items-center justify-center bg-slate-800">
        <div class="text-3xl font-bold text-white">Section 8</div>
    </section>
    <div style="height:1px"></div>

    <script>
        const root = document.documentElement;
        
        // –±—ã—Å—Ç—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è ¬´–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 0 –∏ –≤–∫–ª—é—á–∏—Ç—å snap¬ª
        const goTop = () => {
          root.style.scrollSnapType = 'none';
          scrollTo(0, 0);
          requestAnimationFrame(()=>{
            scrollTo(0, 0);
            root.style.scrollSnapType = 'y mandatory';
          });
        };
        
        // 1) –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        addEventListener('DOMContentLoaded', () => requestAnimationFrame(goTop));
        
        // 2) –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ bfcache
        addEventListener('pageshow', e => e.persisted && goTop());
        
        // 3) pull-to-refresh: –∂–¥—ë–º, –ø–æ–∫–∞ –ø–∞–ª–µ—Ü –æ—Ç–ø—É—Å—Ç—è—Ç –∏ –∏–Ω–µ—Ä—Ü–∏—è —Å—Ç–∏—Ö–Ω–µ—Ç
        let lock = false, idle;
        addEventListener('scroll', () => {
          clearTimeout(idle);
          idle = setTimeout(()=>{
            // –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0 ¬± 80 px ‚Üí –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º
            if (scrollY > -20 && scrollY < 80 && !lock) {
              lock = true;          // –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é
              goTop();
              setTimeout(()=>lock = false, 300);  // —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
            }
          }, 120);                  // –¥–æ–ª—å—à–µ, —á–µ–º —Ä—ã–≤–æ–∫ Safari
        }, { passive:true });
        
        // 4) –ø–µ—Ä–µ–¥ —É—Ö–æ–¥–æ–º —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
        addEventListener('beforeunload', ()=>scrollTo(0,0));
        </script>

        <script>
            // ---------- –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ pull-to-refresh ----------
            let startY = 0, pulling = false;
            
            function onTouchStart(e) {
            if (scrollY === 0) {
                startY = e.touches[0].clientY;   // –∑–∞–ø–æ–º–∏–Ω–∞–µ–º, –≥–¥–µ –Ω–∞—á–∞–ª–∏
                pulling = true;
            }
            }
            
            function onTouchMove(e) {
            if (!pulling) return;
            const y = e.touches[0].clientY;
            const dy = y - startY;
            
            // —Ç–∞—â–∏–º –≤–Ω–∏–∑ (dy > 0) –∏ –≤—Å—ë –µ—â—ë –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É
            if (dy > 0 && scrollY === 0) {
                e.preventDefault();              // –≥–ª—É—à–∏–º PTR
            } else if (dy < 0) {
                // –ø–æ—à—ë–ª —Å–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö ‚Äî —Å–Ω–∏–º–∞–µ–º –±–ª–æ–∫
                pulling = false;
            }
            }
            
            function onTouchEnd() {
            pulling = false;
            }
            
            addEventListener('touchstart', onTouchStart, {passive: false});
            addEventListener('touchmove',  onTouchMove,  {passive: false});
            addEventListener('touchend',   onTouchEnd,   {passive: true});
            </script>

</body>
</html> 